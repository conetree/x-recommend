# 技术蓝图与实施步骤(模板)

## 推荐引擎全流程(可用于生成系统代码)
1. 大数据统计分析
   - 行为事件: 曝光、点击、播放、完播、收藏、追剧、搜索、停留时长
   - 统计指标: CTR、完播率、复播率、冷启动覆盖率、长尾覆盖率
   - 数据处理: Kafka -> Flink 清洗/去重/窗口聚合 -> 特征产出
2. 基于文本的特征提取
   - 内容字段: 标题、简介、演员、导演、标签、剧情摘要
   - 处理流程: 分词/清洗 -> TF-IDF/关键词 -> 轻量Embedding
3. 向量存储
   - 目标对象: 影片向量、用户画像向量、标签向量
   - 存储方式: Faiss索引(单机) + 元数据存Redis/PostgreSQL
4. 相似度检索
   - 以片推片: 输入影片向量 -> Faiss TopK 相似
   - 画像匹配: 用户向量 -> Faiss TopK 候选
5. 召回机制
   - 多路召回: gorse内置 + Item2Vec + 热门/新片/运营池
   - 去重与合并: 统一候选池, 记录来源路由
6. 排序与重排
   - 排序: gorse轻量模型/SVD++
   - 重排: 多样性、冷启动倾斜、运营优先级
7. 接口展现
   - API: `/recommend/user`, `/recommend/item`, `/feed`, `/special`
   - 端侧: TV/移动端渲染, 支持曝光回流

## 技术蓝图(分层)
- 终端层: TV/移动端曝光与点击/播放/完播/收藏/追剧等埋点
- 采集层: SDK/埋点网关 -> Kafka
- 计算层: Flink清洗/聚合/实时画像更新
- 特征层: Redis热特征 + PostgreSQL离线画像
- 召回层: gorse内置召回 + Item2Vec + 热门/新片/运营池
- 向量检索层: Faiss(以片推片/相似片)
- 排序层: gorse排序 + SVD++(可选)
- 重排层: 多样性/新鲜度/去重/运营优先级
- 服务层: 推荐API + 缓存 + 熔断/降级
- 评估层: 指标口径/AB实验/离线评估

## 关键数据流
1. 行为日志 -> Kafka -> Flink清洗 -> 特征/画像存储
2. 离线训练 -> gorse模型更新 -> 在线服务
3. 线上请求 -> 召回 -> 排序 -> 重排 -> 返回

## 依赖关系
- 召回依赖画像/特征可用性
- 排序依赖训练数据质量
- 重排依赖运营配置与策略规则

## 实施步骤(12周建议)
- 第1-2周: 需求确认/埋点与指标口径/数据规范
- 第3-4周: 数据管道与Flink作业/画像落库
- 第5-6周: gorse部署/基础召回/排序初版
- 第7-8周: Faiss相似检索/重排策略/缓存
- 第9-10周: API联调/灰度/线上评估
- 第11-12周: AB实验/优化/上线验收

## 交付物清单
- 技术方案文档
- 数据规范与埋点文档
- 推荐API文档
- 评估与AB方案
- 运维与监控配置
